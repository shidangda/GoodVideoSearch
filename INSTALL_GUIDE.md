# ä¸€é”®å®‰è£…è„šæœ¬ä½¿ç”¨æŒ‡å—

## ç®€ä»‹

`install.sh` æ˜¯ä¸€ä¸ªå…¨è‡ªåŠ¨å®‰è£…éƒ¨ç½²è„šæœ¬ï¼Œå¯ä»¥åœ¨ Ubuntu 20.04 æœåŠ¡å™¨ä¸Šä¸€é”®å®Œæˆæ‰€æœ‰å¿…è¦çš„å®‰è£…å’Œé…ç½®å·¥ä½œã€‚

## è„šæœ¬åŠŸèƒ½

è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆä»¥ä¸‹å·¥ä½œï¼š

1. âœ… **ç³»ç»Ÿæ›´æ–°** - æ›´æ–°ç³»ç»Ÿè½¯ä»¶åŒ…åˆ°æœ€æ–°ç‰ˆæœ¬
2. âœ… **å®‰è£… Node.js** - å®‰è£… Node.js 18+ å’Œ npm
3. âœ… **å®‰è£… MySQL** - å®‰è£…å¹¶é…ç½® MySQL æ•°æ®åº“æœåŠ¡å™¨
4. âœ… **å®‰è£… Nginx** - å®‰è£… Nginx Web æœåŠ¡å™¨
5. âœ… **å®‰è£… PM2** - å®‰è£… PM2 è¿›ç¨‹ç®¡ç†å™¨å¹¶é…ç½®å¼€æœºè‡ªå¯
6. âœ… **å…‹éš†é¡¹ç›®** - ä» Git ä»“åº“å…‹éš†é¡¹ç›®åˆ°æœåŠ¡å™¨
7. âœ… **å®‰è£…ä¾èµ–** - å®‰è£…é¡¹ç›®æ‰€éœ€çš„ npm åŒ…
8. âœ… **é…ç½®æ•°æ®åº“** - åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
9. âœ… **åˆ›å»ºç¯å¢ƒå˜é‡** - åˆ›å»º .env é…ç½®æ–‡ä»¶
10. âœ… **é…ç½® Nginx** - é…ç½®åå‘ä»£ç†
11. âœ… **é…ç½®é˜²ç«å¢™** - å¼€æ”¾å¿…è¦ç«¯å£
12. âœ… **å¯åŠ¨åº”ç”¨** - ä½¿ç”¨ PM2 å¯åŠ¨åº”ç”¨

## ä½¿ç”¨å‰å‡†å¤‡

### 1. æœåŠ¡å™¨è¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Ubuntu 20.04 LTSï¼ˆæ¨èï¼‰æˆ–å…¶ä»– Ubuntu ç‰ˆæœ¬
- **å†…å­˜**: è‡³å°‘ 1GB RAMï¼ˆæ¨è 2GB+ï¼‰
- **ç£ç›˜**: è‡³å°‘ 10GB å¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: èƒ½å¤Ÿè®¿é—®äº’è”ç½‘ï¼ˆç”¨äºä¸‹è½½è½¯ä»¶åŒ…å’Œ Git ä»“åº“ï¼‰

**æ³¨æ„**ï¼š
- **è…¾è®¯äº‘æœåŠ¡å™¨**ï¼šé€šå¸¸å·²é…ç½®å†…ç½‘é•œåƒæºï¼Œnpm å’Œ apt ä¸‹è½½é€Ÿåº¦ä¼šæ›´å¿«
- **å…¶ä»–äº‘æœåŠ¡å™¨**ï¼šå¯èƒ½éœ€è¦é…ç½®é•œåƒæºä»¥åŠ é€Ÿä¸‹è½½

### 2. æœåŠ¡å™¨è®¿é—®

ç¡®ä¿æ‚¨å¯ä»¥é€šè¿‡ SSH è¿æ¥åˆ°æœåŠ¡å™¨ï¼š

```bash
ssh username@your-server-ip
```

### 3. è·å–è„šæœ¬

æœ‰ä¸¤ç§æ–¹å¼è·å–å®‰è£…è„šæœ¬ï¼š

**æ–¹å¼ä¸€ï¼šå¦‚æœé¡¹ç›®å·²åœ¨æœåŠ¡å™¨ä¸Š**

```bash
cd ~/GoodVideoSearch
# è„šæœ¬å·²ç»åœ¨é¡¹ç›®æ ¹ç›®å½•
```

**æ–¹å¼äºŒï¼šç›´æ¥ä¸‹è½½è„šæœ¬**

```bash
# åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºç›®å½•
mkdir -p ~/install
cd ~/install

# ä¸‹è½½è„šæœ¬ï¼ˆä½¿ç”¨ wget æˆ– curlï¼‰
wget https://raw.githubusercontent.com/shidangda/GoodVideoSearch/main/install.sh
# æˆ–
curl -O https://raw.githubusercontent.com/shidangda/GoodVideoSearch/main/install.sh
```

## å®‰è£…æ­¥éª¤

### æ­¥éª¤ 1: ä¸Šä¼ è„šæœ¬åˆ°æœåŠ¡å™¨

å¦‚æœè„šæœ¬åœ¨æœ¬åœ°ï¼Œä½¿ç”¨ SCP ä¸Šä¼ ï¼š

```bash
# åœ¨æœ¬åœ°æ‰§è¡Œ
scp install.sh username@your-server-ip:~/
```

### æ­¥éª¤ 2: è¿æ¥åˆ°æœåŠ¡å™¨

```bash
ssh username@your-server-ip
```

### æ­¥éª¤ 3: è®¾ç½®æ‰§è¡Œæƒé™

```bash
chmod +x install.sh
```

### æ­¥éª¤ 4: æ‰§è¡Œå®‰è£…è„šæœ¬

**é‡è¦ï¼šå¿…é¡»ä½¿ç”¨ sudo è¿è¡Œï¼**

```bash
sudo ./install.sh
```

### æ­¥éª¤ 5: æŒ‰ç…§æç¤ºæ“ä½œ

è„šæœ¬æ˜¯äº¤äº’å¼çš„ï¼Œä¼šè¯¢é—®æ‚¨ä¸€äº›ä¿¡æ¯ï¼š

1. **ç¡®è®¤å®‰è£…** - è¾“å…¥ `y` ç»§ç»­
2. **npm é•œåƒé…ç½®** - å…³äº npm é•œåƒçš„è¯´æ˜ï¼š
   - **è…¾è®¯äº‘ç”¨æˆ·**ï¼šå¦‚æœæ‚¨çš„æœåŠ¡å™¨å·²é…ç½®å†…ç½‘é•œåƒï¼Œè„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶æç¤ºï¼Œ**å»ºè®®é€‰æ‹© `n` ä¿æŒç°æœ‰é…ç½®**
   - **å…¶ä»–ç”¨æˆ·**ï¼šå¦‚æœä¸‹è½½é€Ÿåº¦æ…¢ï¼Œå¯ä»¥é€‰æ‹© `y` ä½¿ç”¨æ·˜å®é•œåƒåŠ é€Ÿ
   - è„šæœ¬ä¼šæ˜¾ç¤ºå½“å‰å·²é…ç½®çš„é•œåƒåœ°å€ï¼Œæ‚¨å¯ä»¥æ ¹æ®æƒ…å†µå†³å®š
3. **æ•°æ®åº“å¯†ç ** - è¾“å…¥æ•°æ®åº“ç”¨æˆ·å¯†ç ï¼ˆè¯·è®°ä½è¿™ä¸ªå¯†ç ï¼ï¼‰
4. **åº”ç”¨ç«¯å£** - é»˜è®¤ 3000ï¼Œå¯ç›´æ¥æŒ‰ Enter
5. **åŸŸåæˆ– IP** - è¾“å…¥åŸŸåæˆ–æŒ‰ Enter ä½¿ç”¨æœåŠ¡å™¨ IP
6. **é˜²ç«å¢™** - æ˜¯å¦å¯ç”¨é˜²ç«å¢™ï¼ˆæ¨èé€‰æ‹© `y`ï¼‰

### æ­¥éª¤ 6: ç­‰å¾…å®‰è£…å®Œæˆ

å®‰è£…è¿‡ç¨‹å¯èƒ½éœ€è¦ 5-15 åˆ†é’Ÿï¼Œå–å†³äºç½‘ç»œé€Ÿåº¦ã€‚è„šæœ¬ä¼šæ˜¾ç¤ºè¯¦ç»†çš„å®‰è£…è¿›åº¦ã€‚

## å®‰è£…åéªŒè¯

### 1. æ£€æŸ¥åº”ç”¨çŠ¶æ€

```bash
pm2 status
```

åº”è¯¥çœ‹åˆ° `goodvideosearch` è¿›ç¨‹çŠ¶æ€ä¸º `online`ã€‚

### 2. æŸ¥çœ‹åº”ç”¨æ—¥å¿—

```bash
pm2 logs goodvideosearch
```

### 3. è®¿é—®åº”ç”¨

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š

```
http://your-server-ip
```

æˆ–å¦‚æœé…ç½®äº†åŸŸåï¼š

```
http://your-domain.com
```

### 4. æ£€æŸ¥ Nginx çŠ¶æ€

```bash
sudo systemctl status nginx
```

## å¸¸è§é—®é¢˜

### Q1: å®‰è£…è¿‡ç¨‹ä¸­æ–­æ€ä¹ˆåŠï¼Ÿ

A: è„šæœ¬ä½¿ç”¨ `set -e`ï¼Œé‡åˆ°é”™è¯¯ä¼šè‡ªåŠ¨é€€å‡ºã€‚æ‚¨å¯ä»¥ï¼š
- æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ï¼Œä¿®å¤é—®é¢˜åé‡æ–°è¿è¡Œè„šæœ¬
- è„šæœ¬ä¼šæ£€æµ‹å·²å®‰è£…çš„ç»„ä»¶ï¼Œä¸ä¼šé‡å¤å®‰è£…

### Q2: MySQL è¿æ¥å¤±è´¥ï¼Ÿ

A: å¯èƒ½çš„åŸå› ï¼š
1. MySQL æœåŠ¡æœªå¯åŠ¨ï¼š`sudo systemctl start mysql`
2. å¯†ç é”™è¯¯ï¼šæ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„å¯†ç 
3. ç”¨æˆ·æƒé™é—®é¢˜ï¼šæ£€æŸ¥æ•°æ®åº“ç”¨æˆ·æ˜¯å¦åˆ›å»ºæˆåŠŸ

### Q3: åº”ç”¨æ— æ³•è®¿é—®ï¼Ÿ

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. åº”ç”¨æ˜¯å¦è¿è¡Œï¼š`pm2 status`
2. ç«¯å£æ˜¯å¦å¼€æ”¾ï¼š`sudo ufw status`
3. Nginx é…ç½®æ˜¯å¦æ­£ç¡®ï¼š`sudo nginx -t`
4. æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼š`pm2 logs goodvideosearch`

### Q4: å¦‚ä½•ä¿®æ”¹é…ç½®ï¼Ÿ

A: ä¸»è¦é…ç½®æ–‡ä»¶ï¼š
- ç¯å¢ƒå˜é‡ï¼š`~/GoodVideoSearch/.env`
- Nginx é…ç½®ï¼š`/etc/nginx/sites-available/goodvideosearch`
- PM2 é…ç½®ï¼š`~/GoodVideoSearch/ecosystem.config.js`

ä¿®æ”¹åéœ€è¦ï¼š
- ç¯å¢ƒå˜é‡ï¼š`pm2 restart goodvideosearch`
- Nginxï¼š`sudo nginx -t && sudo systemctl reload nginx`

### Q5: å¦‚ä½•æ›´æ–°åº”ç”¨ï¼Ÿ

A: æ›´æ–°æ­¥éª¤ï¼š

```bash
cd ~/GoodVideoSearch
git pull
npm install --production
pm2 restart goodvideosearch
```

### Q6: å¦‚ä½•å¤‡ä»½æ•°æ®ï¼Ÿ

A: å¤‡ä»½æ•°æ®åº“ï¼š

```bash
mysqldump -u goodvideo_user -p goodvideo_archive > backup_$(date +%Y%m%d).sql
```

å¤‡ä»½æ–‡ä»¶ï¼š

```bash
tar -czf covers_backup_$(date +%Y%m%d).tar.gz ~/GoodVideoSearch/data/covers
```

## è„šæœ¬è‡ªå®šä¹‰

å¦‚æœéœ€è¦ä¿®æ”¹è„šæœ¬çš„é»˜è®¤é…ç½®ï¼Œå¯ä»¥ç¼–è¾‘è„šæœ¬å¼€å¤´çš„é…ç½®å˜é‡ï¼š

```bash
# ç¼–è¾‘è„šæœ¬
nano install.sh

# ä¿®æ”¹è¿™äº›å˜é‡
GIT_REPO="https://github.com/shidangda/GoodVideoSearch.git"
PROJECT_DIR="$HOME/GoodVideoSearch"
NODE_VERSION="18"
DB_NAME="goodvideo_archive"
# ... ç­‰ç­‰
```

## å®‰å…¨å»ºè®®

1. **ä¿®æ”¹é»˜è®¤å¯†ç ** - å®‰è£…åç«‹å³ä¿®æ”¹æ•°æ®åº“å¯†ç 
2. **é…ç½® SSL** - ä½¿ç”¨ Let's Encrypt é…ç½® HTTPS
3. **å®šæœŸæ›´æ–°** - ä¿æŒç³»ç»Ÿå’Œè½¯ä»¶åŒ…æ›´æ–°
4. **å¤‡ä»½æ•°æ®** - å®šæœŸå¤‡ä»½æ•°æ®åº“å’Œæ–‡ä»¶
5. **é˜²ç«å¢™** - åªå¼€æ”¾å¿…è¦çš„ç«¯å£

## è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹è„šæœ¬è¾“å‡ºçš„é”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥æ—¥å¿—æ–‡ä»¶ï¼š
   - åº”ç”¨æ—¥å¿—ï¼š`pm2 logs goodvideosearch`
   - Nginx æ—¥å¿—ï¼š`sudo tail -f /var/log/nginx/goodvideosearch_error.log`
   - ç³»ç»Ÿæ—¥å¿—ï¼š`sudo journalctl -xe`
3. æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£ï¼š`DEPLOY.md`

## å¸è½½ï¼ˆå¦‚æœéœ€è¦ï¼‰

å¦‚æœéœ€è¦å®Œå…¨å¸è½½ï¼š

```bash
# åœæ­¢å¹¶åˆ é™¤ PM2 åº”ç”¨
pm2 stop goodvideosearch
pm2 delete goodvideosearch

# åˆ é™¤é¡¹ç›®ç›®å½•
rm -rf ~/GoodVideoSearch

# åˆ é™¤ Nginx é…ç½®
sudo rm /etc/nginx/sites-enabled/goodvideosearch
sudo rm /etc/nginx/sites-available/goodvideosearch
sudo systemctl reload nginx

# åˆ é™¤æ•°æ®åº“ï¼ˆå¯é€‰ï¼‰
sudo mysql -u root -p
# åœ¨ MySQL ä¸­æ‰§è¡Œï¼š
# DROP DATABASE goodvideo_archive;
# DROP USER 'goodvideo_user'@'localhost';
```

---

**ç¥æ‚¨éƒ¨ç½²é¡ºåˆ©ï¼** ğŸš€

